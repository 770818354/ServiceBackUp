# æœåŠ¡å™¨å¢é‡å¤‡ä»½å·¥å…·

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æœåŠ¡å™¨è‡ªåŠ¨å¤‡ä»½å·¥å…·ï¼Œæ”¯æŒSSH/SCPåè®®ï¼Œé‡‡ç”¨æ™ºèƒ½å¢é‡å¤‡ä»½æœºåˆ¶ï¼Œå¤§å¹…æå‡å¤‡ä»½æ•ˆç‡ã€‚

## ç‰¹æ€§

- **æ™ºèƒ½å¢é‡å¤‡ä»½**: é¦–æ¬¡å…¨é‡å¤‡ä»½ï¼Œåç»­åªå¤‡ä»½æœ‰å˜åŒ–çš„æ–‡ä»¶
- **å®æ—¶è¿›åº¦æ˜¾ç¤º**: è¯¦ç»†çš„å¤‡ä»½è¿›åº¦æ¡å’Œä¼ è¾“é€Ÿåº¦æ˜¾ç¤º
- **ç‰ˆæœ¬ç®¡ç†**: è‡ªåŠ¨ä¿ç•™å¤šä¸ªå†å²ç‰ˆæœ¬ï¼Œæ”¯æŒç‰ˆæœ¬å›æ»š
- **å®šæ—¶å¤‡ä»½**: æ”¯æŒè‡ªå®šä¹‰å¤‡ä»½æ—¶é—´ï¼Œè‡ªåŠ¨æ‰§è¡Œå¤‡ä»½ä»»åŠ¡
- **å®‰å…¨å¯é **: æ”¯æŒSSHå¯†é’¥è®¤è¯ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“å®‰å…¨
- **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„å¤‡ä»½æ—¥å¿—è®°å½•ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
-  **çµæ´»é…ç½®**: æ”¯æŒå¤šæœåŠ¡å™¨ã€å¤šè·¯å¾„ã€æ’é™¤è§„åˆ™ç­‰é…ç½®

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.6+
- Windows/Linux/macOS

### 2. å®‰è£…ä¾èµ–

**Windows:**
```bash
install.bat
```

**Linux/macOS:**
```bash
pip install -r requirements.txt
```

### 3. é…ç½®æœåŠ¡å™¨

ç¼–è¾‘ `backup_config.json` æ–‡ä»¶ï¼Œé…ç½®ä½ çš„æœåŠ¡å™¨ä¿¡æ¯ï¼š

```json
{
    "servers": [
        {
            "name": "æˆ‘çš„WebæœåŠ¡å™¨",
            "host": "192.168.1.100",
            "port": 22,
            "username": "root",
            "password": "your-password",
            "protocol": "ssh",
            "remote_paths": [
                "/var/www/html",
                "/home/user/data",
                "/etc/nginx"
            ],
            "exclude_patterns": [
                "*.log",
                "*.tmp",
                "__pycache__",
                ".git",
                "node_modules",
                "*.cache"
            ]
        }
    ],
    "backup_settings": {
        "local_backup_dir": "./backups",
        "max_backup_versions": 7,
        "compression": true,
        "encryption": false,
        "log_level": "INFO",
        "show_detailed_progress": true,
        "show_current_file": true
    },
    "schedule": {
        "enabled": true,
        "interval_hours": 6,
        "backup_times": ["09:00", "12:00", "17:00", "00:00"]
    }
}
```

### 4. ä½¿ç”¨è„šæœ¬

**æ‰‹åŠ¨å¤‡ä»½æ‰€æœ‰æœåŠ¡å™¨ï¼š**
```bash
python backup_script.py
```

**å¤‡ä»½æŒ‡å®šæœåŠ¡å™¨ï¼š**
```bash
python backup_script.py --server "æˆ‘çš„WebæœåŠ¡å™¨"
```

**æµ‹è¯•é…ç½®ï¼š**
```bash
python backup_script.py --test
```

**å¯åŠ¨å®šæ—¶å¤‡ä»½ï¼š**
```bash
python schedule_backup.py
```

**æ£€æŸ¥é…ç½®ï¼š**
```bash
python check_config.py
```

## é¡¹ç›®ç»“æ„

```
ServiceBackUp/
â”œâ”€â”€ backup_script.py          # ä¸»å¤‡ä»½è„šæœ¬
â”œâ”€â”€ schedule_backup.py        # å®šæ—¶ä»»åŠ¡è„šæœ¬
â”œâ”€â”€ check_config.py          # é…ç½®æ£€æŸ¥è„šæœ¬
â”œâ”€â”€ backup_config.json       # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”œâ”€â”€ install.bat             # Windowså®‰è£…è„šæœ¬
â”œâ”€â”€ backup.bat              # Windowså¤‡ä»½è„šæœ¬
â”œâ”€â”€ schedule.bat            # Windowså®šæ—¶è„šæœ¬
â”œâ”€â”€ start_backup.bat        # Windowså¯åŠ¨è„šæœ¬
â”œâ”€â”€ logs/                   # æ—¥å¿—ç›®å½•
â””â”€â”€ backups/                # å¤‡ä»½æ–‡ä»¶ç›®å½•
    â””â”€â”€ æœåŠ¡å™¨åç§°/
        â”œâ”€â”€ current/        # å½“å‰å¤‡ä»½ï¼ˆå¢é‡åŸºç¡€ï¼‰
        â”œâ”€â”€ 20240101_090000/ # ç‰ˆæœ¬å¤‡ä»½1
        â”œâ”€â”€ 20240101_120000/ # ç‰ˆæœ¬å¤‡ä»½2
        â””â”€â”€ hash_index/     # æ–‡ä»¶å“ˆå¸Œç´¢å¼•
```

## é…ç½®è¯´æ˜

### æœåŠ¡å™¨é…ç½®

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `name` | æœåŠ¡å™¨åç§° | "æˆ‘çš„WebæœåŠ¡å™¨" |
| `host` | æœåŠ¡å™¨IPæˆ–åŸŸå | "192.168.1.100" |
| `port` | SSHç«¯å£ | 22 |
| `username` | ç”¨æˆ·å | "root" |
| `password` | å¯†ç  | "your-password" |
| `protocol` | åè®®ç±»å‹ | "ssh" |
| `remote_paths` | è¦å¤‡ä»½çš„è¿œç¨‹è·¯å¾„ | ["/var/www/html"] |
| `exclude_patterns` | æ’é™¤çš„æ–‡ä»¶æ¨¡å¼ | ["*.log", "*.tmp"] |

### å¤‡ä»½è®¾ç½®

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `local_backup_dir` | æœ¬åœ°å¤‡ä»½ç›®å½• | "./backups" |
| `max_backup_versions` | æœ€å¤§ä¿ç•™ç‰ˆæœ¬æ•° | 7 |
| `compression` | æ˜¯å¦å‹ç¼© | true |
| `encryption` | æ˜¯å¦åŠ å¯† | false |
| `log_level` | æ—¥å¿—çº§åˆ« | "INFO" |
| `show_detailed_progress` | æ˜¾ç¤ºè¯¦ç»†è¿›åº¦ | true |
| `show_current_file` | æ˜¾ç¤ºå½“å‰æ–‡ä»¶ | true |

### å®šæ—¶è®¾ç½®

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `enabled` | æ˜¯å¦å¯ç”¨å®šæ—¶å¤‡ä»½ | true |
| `interval_hours` | å¤‡ä»½é—´éš”ï¼ˆå°æ—¶ï¼‰ | 6 |
| `backup_times` | å¤‡ä»½æ—¶é—´ç‚¹ | ["09:00", "12:00"] |

## å¤‡ä»½æœºåˆ¶

### å¢é‡å¤‡ä»½åŸç†

1. **é¦–æ¬¡å¤‡ä»½**: å…¨é‡ä¸‹è½½æ‰€æœ‰æ–‡ä»¶åˆ° `current` ç›®å½•
2. **å»ºç«‹ç´¢å¼•**: ä¸ºæ¯ä¸ªæ–‡ä»¶è®¡ç®—MD5å“ˆå¸Œå€¼ï¼Œå»ºç«‹æ–‡ä»¶ç´¢å¼•
3. **å¢é‡å¤‡ä»½**: æ¯”è¾ƒè¿œç¨‹æ–‡ä»¶å“ˆå¸Œä¸æœ¬åœ°ç´¢å¼•ï¼Œåªä¸‹è½½æœ‰å˜åŒ–çš„æ–‡ä»¶
4. **ç‰ˆæœ¬ç®¡ç†**: æ¯æ¬¡å¤‡ä»½å®Œæˆååˆ›å»ºæ—¶é—´æˆ³ç‰ˆæœ¬å¿«ç…§
5. **è‡ªåŠ¨æ¸…ç†**: ä¿ç•™æŒ‡å®šæ•°é‡çš„å†å²ç‰ˆæœ¬ï¼Œåˆ é™¤è¿‡æœŸç‰ˆæœ¬

### å¤‡ä»½ç›®å½•ç»“æ„

```
backups/
â””â”€â”€ æœåŠ¡å™¨åç§°/
    â”œâ”€â”€ current/              # å¢é‡å¤‡ä»½åŸºç¡€ç›®å½•
    â”‚   â”œâ”€â”€ var/
    â”‚   â”‚   â””â”€â”€ www/
    â”‚   â”‚       â””â”€â”€ html/
    â”‚   â””â”€â”€ home/
    â”‚       â””â”€â”€ user/
    â”‚           â””â”€â”€ data/
    â”œâ”€â”€ 20240101_090000/      # ç‰ˆæœ¬å¤‡ä»½1
    â”œâ”€â”€ 20240101_120000/      # ç‰ˆæœ¬å¤‡ä»½2
    â””â”€â”€ hash_index/           # æ–‡ä»¶å“ˆå¸Œç´¢å¼•
        â””â”€â”€ æœåŠ¡å™¨åç§°_hash.json
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```bash
# å¤‡ä»½æ‰€æœ‰æœåŠ¡å™¨
python backup_script.py

# å¤‡ä»½æŒ‡å®šæœåŠ¡å™¨
python backup_script.py --server "æˆ‘çš„WebæœåŠ¡å™¨"

# æµ‹è¯•é…ç½®
python backup_script.py --test
```

### å®šæ—¶å¤‡ä»½

```bash
# å¯åŠ¨å®šæ—¶å¤‡ä»½æœåŠ¡
python schedule_backup.py
```

### Windowsæ‰¹å¤„ç†

```bash
# å®‰è£…ä¾èµ–
install.bat

# æ‰§è¡Œå¤‡ä»½
backup.bat

# å¯åŠ¨å®šæ—¶å¤‡ä»½
schedule.bat
```

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### å¤šæœåŠ¡å™¨é…ç½®

```json
{
    "servers": [
        {
            "name": "WebæœåŠ¡å™¨",
            "host": "192.168.1.100",
            "username": "root",
            "password": "password1",
            "remote_paths": ["/var/www/html"]
        },
        {
            "name": "æ•°æ®åº“æœåŠ¡å™¨",
            "host": "192.168.1.101",
            "username": "mysql",
            "password": "password2",
            "remote_paths": ["/var/lib/mysql"]
        }
    ]
}
```

### æ’é™¤è§„åˆ™é…ç½®

```json
{
    "exclude_patterns": [
        "*.log",           # æ’é™¤æ—¥å¿—æ–‡ä»¶
        "*.tmp",           # æ’é™¤ä¸´æ—¶æ–‡ä»¶
        "__pycache__",     # æ’é™¤Pythonç¼“å­˜
        ".git",            # æ’é™¤Gitç›®å½•
        "node_modules",    # æ’é™¤Node.jsä¾èµ–
        "*.cache",         # æ’é™¤ç¼“å­˜æ–‡ä»¶
        "*.bak"            # æ’é™¤å¤‡ä»½æ–‡ä»¶
    ]
}
```

## æ—¥å¿—è¯´æ˜

æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ `logs/` ç›®å½•ä¸‹ï¼ŒæŒ‰æ—¥æœŸå‘½åï¼š
- `backup_20240101.log` - å¤‡ä»½æ—¥å¿—
- `schedule.log` - å®šæ—¶ä»»åŠ¡æ—¥å¿—

æ—¥å¿—åŒ…å«è¯¦ç»†çš„å¤‡ä»½ä¿¡æ¯ï¼š
- è¿æ¥çŠ¶æ€
- æ–‡ä»¶ä¼ è¾“è¿›åº¦
- é”™è¯¯ä¿¡æ¯
- å¤‡ä»½ç»Ÿè®¡

## æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**: å»ºè®®ä½¿ç”¨SSHå¯†é’¥è®¤è¯æ›¿ä»£å¯†ç è®¤è¯
2. **ç½‘ç»œç¨³å®š**: ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šï¼Œé¿å…å¤‡ä»½ä¸­æ–­
3. **ç£ç›˜ç©ºé—´**: ç¡®ä¿æœ¬åœ°æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å­˜å‚¨å¤‡ä»½æ–‡ä»¶
4. **æƒé™è®¾ç½®**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®è¿œç¨‹ç›®å½•
5. **é˜²ç«å¢™**: ç¡®ä¿SSHç«¯å£ï¼ˆé»˜è®¤22ï¼‰æœªè¢«é˜²ç«å¢™é˜»æ­¢

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶
